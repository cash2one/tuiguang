/*************************************** 添加或编辑企业的界面**************************************/Ext.define('AddStuff', {    extend: 'Ext.window.Window',	alias:'widget.addstuff',    width: 400,    layout: {        type: 'fit'    },    title: '添加企业',	autoShow:true,	border:false,	modal:true,    initComponent: function() {        var me = this;        Ext.applyIf(me, {            items: [                {                    xtype: 'form',                    bodyPadding: 10,                    title: '',					defaults:{						allowBlank:false					},                    items: [						{							xtype:'hidden',							name:'id'						},                        {                            xtype: 'textfield',                            fieldLabel: '企业编号',                            labelWidth: 60,							name:'stuff_index',                            anchor: '100%'                        },                        {                            xtype: 'textfield',                            fieldLabel: '企业名称',                            labelWidth: 60,							name:'stuff_name',                            anchor: '100%'                        },                        {                            xtype: 'combobox',                            fieldLabel: '状态',                            labelWidth: 60,							name:'status',							displayField:'label',							valueField:'value',                            anchor: '100%',							store:{								fields:['value','label'],								data:[									{value:'0',label:'冻结'},									{value:'1',label:'正常'}								],								autoLoad:true							}                        },                        {                            xtype: 'textareafield',                            height: 80,                            fieldLabel: '备注',                            labelWidth: 60,							name:'notion',                            anchor: '100%'                        },                        {                            xtype: 'container',                            margin: '10 0 0 65',                            items: [                                {                                    xtype: 'button',                                    text: '提交',									iconCls:'add-button',									handler:function(btn){										var form=btn.up('form').getForm();										var win=btn.up('window');										if(form.isValid())										{											form.submit({												url:'stuffs/add_stuff.php',												waitMsg:'正在提交...',												success:function(form,action){													Ext.Msg.alert('信息提示',action.result.msg);													win.close();													Ext.getCmp('stuffsgrid').getStore().load();												},												failure:function(form,action){													Ext.Msg.alert('信息提示',action.result.msg);												}											});										}									}                                },                                {                                    xtype: 'button',                                    margin: '0 0 0 5',                                    text: '取消',									iconCls:'delete-button',									handler:function(btn){										btn.up('window').close();									}                                }                            ]                        }                    ]                }            ]        });        me.callParent(arguments);    }});/******************************************* 企业列表的model和store******************************************/Ext.define('Stuff', {    extend: 'Ext.data.Model',    fields: [		'id',		'stuff_index',		'stuff_name',		'status',		'notion'    ]});var Stuffs = Ext.create('Ext.data.Store', {    model: 'Stuff',    proxy: {        type: 'ajax',        url : 'stuffs/list_stuffs.php',        reader: {            type: 'json',            root: 'root'        }    },    autoLoad: true});/*************************************** 企业列表界面**************************************/Ext.define('StuffsGrid', {    extend:'Ext.grid.Panel',	alias:'widget.stuffsgrid',    height:490,    width:797,    title:'企业管理',	id:'stuffsgrid',	store:Stuffs,    initComponent: function(){        var me = this;        Ext.applyIf(me, {            columns:[                {                    xtype: 'gridcolumn',                    dataIndex: 'stuff_index',                    text: '企业编号',					width:200                },                {                    xtype: 'gridcolumn',                    dataIndex: 'stuff_name',                    text: '企业名称',					width:300                },                {                    xtype: 'gridcolumn',                    dataIndex: 'status',                    text: '状态',					width:300,					renderer:function(val){						return val==1?'正常':"<span class='red'>冻结</span>";					}                },                {                    xtype: 'gridcolumn',                    dataIndex: 'notion',                    text: '备注',					flex:1                },				{					xtype:'actioncolumn',					items:[						{							icon:'../img/user.png',							iconCls:'action-img',							handler:function(grid,row){								var rec=grid.getStore().getAt(row);								var win=Ext.widget('window',{									layout:'fit',									modal:true,									stuff_id:rec.get('id'),									stuff_name:rec.get('stuff_name'),									title:rec.get('stuff_name')+'-用户列表',									border:false								});																win.add({									xtype:'usersgrid'								});																win.show();							}						}					]				}            ],            viewConfig: {            },            dockedItems: [                {                    xtype: 'pagingtoolbar',                    store:Stuffs,                    displayInfo: true,                    dock: 'bottom'                },                {                    xtype: 'toolbar',                    dock: 'top',                    items: [                        {                            xtype: 'button',                            text: '添加',							iconCls:'add-button',							handler:function(){								Ext.widget('addstuff');							}                        },						'-',                        {                            xtype: 'button',                            text: '编辑',							iconCls:'edit-button',							handler:function(btn){								var sel=btn.up('grid').getSelectionModel().getSelection();								if(sel.length==0)								{									Ext.Msg.alert('信息提示','请选择企业');								}								else								{										var win=Ext.widget('addstuff',{										title:'编辑企业'									});									win.down('form').loadRecord(sel[0]);								}							}                        },						'-',                        {                            xtype: 'button',                            text: '删除',							iconCls:'delete-button',							handler:function(btn){								var sel=btn.up('grid').getSelectionModel().getSelection();								if(sel.length==0)								{									Ext.Msg.alert('信息提示','请选择企业');								}								else								{									Ext.Msg.confirm('信息提示','确认删除吗？',function(button){										if(button=='yes')										{											var arr=[];											Ext.Array.each(sel,function(item){												arr.push(item.get('id'));											});																						Ext.Ajax.request({												url:'stuffs/delete_stuffs.php',												params:{													ids:arr.join(',')												},												success:function(res){													Ext.Msg.alert('信息提示',res.responseText);													Ext.getCmp('stuffsgrid').getStore().load();												},												faliure:function(){													Ext.Msg.alert('信息提示','请求失败');												}											});										}									});								}							}                        }                    ]                }            ],            selModel: Ext.create('Ext.selection.CheckboxModel', {            })        });        me.callParent(arguments);    }});